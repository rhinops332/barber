<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ניהול עיצוב</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex h-screen">

  <!-- אזור הכפתורים -->
  <div class="w-3/4 p-4 grid grid-cols-1 gap-6 overflow-y-auto">

    <!-- ימים -->
    <div>
      <h2 class="text-lg font-bold mb-2">ימים</h2>
      <div class="grid grid-cols-7 gap-2">
        {% for day in days %}
          <button 
            class="day-btn px-4 py-2 text-white rounded-lg"
            style="background-color: {{ day.background }}; color: {{ day.text_color }}; border-radius: {{ day.border_radius }};"
            data-type="day"
            data-id="{{ day.id }}"
          >
            {{ day.name }}
          </button>
        {% endfor %}
      </div>
    </div>

    <!-- שעות -->
    <div>
      <h2 class="text-lg font-bold mb-2">שעות</h2>
      <div class="grid grid-cols-5 gap-2">
        {% for slot in slots %}
          <button 
            class="slot-btn px-4 py-2 text-white rounded-lg"
            style="background-color: {{ slot.background }}; color: {{ slot.text_color }}; border-radius: {{ slot.border_radius }};"
            data-type="slot"
            data-id="{{ slot.id }}"
          >
            {{ slot.label }}
          </button>
        {% endfor %}
      </div>
    </div>

  </div>

  <!-- פאנל צדדי -->
  <div id="side-panel" class="w-1/4 bg-white p-4 border-l border-gray-300">
    <h2 class="text-lg font-bold mb-4">אפשרויות</h2>

    <!-- תוכן משתנה -->
    <div id="panel-content">
      <p class="text-gray-500">בחר כפתור כדי לשנות</p>
    </div>

    <!-- תמיד זמין -->
    <div class="mt-6">
      <label class="block text-sm font-medium">צבע רקע</label>
      <input type="color" id="background-color" class="w-full h-10 p-0 border mt-1">
    </div>

    <button id="save-btn" class="mt-6 w-full bg-blue-500 text-white py-2 rounded-lg">שמירה</button>
  </div>

  <script>
    const panelContent = document.getElementById("panel-content");
    const saveBtn = document.getElementById("save-btn");
    let selectedElement = null;

    // האזנה לכל הכפתורים
    document.querySelectorAll(".day-btn, .slot-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        selectedElement = btn;
        const type = btn.dataset.type;
        const id = btn.dataset.id;

        // עדכון הפאנל
        panelContent.innerHTML = `
          <p class="mb-2">עריכת ${type === "day" ? "יום" : "שעה"}: <strong>${btn.innerText}</strong></p>
          <label class="block text-sm font-medium">צבע טקסט</label>
          <input type="color" id="text-color" class="w-full h-10 border mt-1" value="${rgb2hex(btn.style.color)}">

          <label class="block text-sm font-medium mt-4">צורת כפתור</label>
          <select id="border-radius" class="w-full border mt-1 p-2">
            <option value="0px" ${btn.style.borderRadius === "0px" ? "selected" : ""}>ריבוע</option>
            <option value="8px" ${btn.style.borderRadius === "8px" ? "selected" : ""}>מעוגל קלות</option>
            <option value="9999px" ${btn.style.borderRadius === "9999px" ? "selected" : ""}>עיגול</option>
          </select>
        `;

        document.getElementById("background-color").value = rgb2hex(btn.style.backgroundColor);
      });
    });

    // המרת צבע HEX
    function rgb2hex(rgb) {
      if (!rgb) return "#000000";
      const result = rgb.match(/\d+/g);
      if (!result) return "#000000";
      return "#" + result.slice(0, 3).map(x => {
        const hex = parseInt(x).toString(16);
        return hex.length === 1 ? "0" + hex : hex;
      }).join("");
    }

    // שמירה
    saveBtn.addEventListener("click", () => {
      if (!selectedElement) return alert("לא נבחר כפתור");

      const bg = document.getElementById("background-color").value;
      const text = document.getElementById("text-color")?.value || selectedElement.style.color;
      const radius = document.getElementById("border-radius")?.value || selectedElement.style.borderRadius;

      selectedElement.style.backgroundColor = bg;
      selectedElement.style.color = text;
      selectedElement.style.borderRadius = radius;

      // TODO: שליחה לשרת ב-AJAX
      console.log("Saving:", {
        id: selectedElement.dataset.id,
        type: selectedElement.dataset.type,
        bg, text, radius
      });
    });
  </script>
</body>
</html>
