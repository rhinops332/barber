<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>עורך עיצוב</title>
    <style>
        body {
            background-color: {{ settings.body_background_color }};
            color: {{ settings.body_text_color }};
            font-family: {{ settings.body_font_family }};
            font-size: {{ settings.body_font_size }};
            margin: {{ settings.body_margin }};
            padding: {{ settings.body_padding }};
            max-width: {{ settings.body_max_width }};
        }
        h1 {
            font-family: {{ settings.heading_font_family }};
            font-size: {{ settings.heading_font_size }};
        }
        h2 {
            font-family: {{ settings.heading_font_family }};
            font-size: calc({{ settings.heading_font_size }} - 4px);
        }
        .day-button {
            background-color: {{ settings.day_button_background }};
            color: {{ settings.day_button_text_color }};
            border-radius: {{ settings.day_button_border_radius }};
            padding: {{ settings.day_button_padding }};
            cursor: pointer;
            margin: 6px;
        }
        .slot-button {
            background-color: {{ settings.slot_button_background }};
            color: {{ settings.slot_button_text_color }};
            border-radius: {{ settings.slot_button_border_radius }};
            padding: {{ settings.slot_button_padding }};
            cursor: pointer;
            margin: 6px;
        }
        .editor-panel {
            position: fixed;
            top: 10px;
            left: 10px;
            background: #fff;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            display: none;
            z-index: 1000;
        }
        .editor-panel.active {
            display: block;
        }
    </style>
</head>
<body>
    <h1 id="page-title" contenteditable="true">{{ settings.page_title }}</h1>
    <h2 id="page-subtitle" contenteditable="true">{{ settings.page_subtitle }}</h2>

    <!-- כפתור יום אחד -->
    <button id="day-button" class="day-button">יום</button>

    <!-- כפתור שעה אחד -->
    <button id="slot-button" class="slot-button">10:00</button>

    <!-- פאנל עריכה -->
    <div id="editor-panel" class="editor-panel">
        <h3>עריכת אלמנט</h3>
        <label>צבע רקע: <input type="color" id="bg-color"></label><br>
        <label>צבע טקסט: <input type="color" id="text-color"></label><br>
        <label>פונט: <input type="text" id="font-family"></label><br>
        <label>גודל טקסט: <input type="text" id="font-size"></label><br>
        <label>Border Radius: <input type="text" id="border-radius"></label><br>
        <label>Padding: <input type="text" id="padding"></label><br>
        <button onclick="saveChanges()">שמור</button>
    </div>

    <script>
        let selectedElement = null;
        let selectedType = null;

        function openEditor(element, type) {
            selectedElement = element;
            selectedType = type;

            // לטעון ערכים מהסטייל הנוכחי
            document.getElementById('bg-color').value = rgbToHex(window.getComputedStyle(element).backgroundColor);
            document.getElementById('text-color').value = rgbToHex(window.getComputedStyle(element).color);
            document.getElementById('font-family').value = window.getComputedStyle(element).fontFamily;
            document.getElementById('font-size').value = window.getComputedStyle(element).fontSize;
            document.getElementById('border-radius').value = window.getComputedStyle(element).borderRadius;
            document.getElementById('padding').value = window.getComputedStyle(element).padding;

            document.getElementById('editor-panel').classList.add('active');
        }

        function saveChanges() {
            if (!selectedElement || !selectedType) return;

            let bg = document.getElementById('bg-color').value;
            let color = document.getElementById('text-color').value;
            let fontFamily = document.getElementById('font-family').value;
            let fontSize = document.getElementById('font-size').value;
            let borderRadius = document.getElementById('border-radius').value;
            let padding = document.getElementById('padding').value;

            if (selectedType === 'title' || selectedType === 'subtitle') {
                selectedElement.style.color = color;
                selectedElement.style.fontFamily = fontFamily;
                selectedElement.style.fontSize = fontSize;
            } else {
                selectedElement.style.backgroundColor = bg;
                selectedElement.style.color = color;
                selectedElement.style.fontFamily = fontFamily;
                selectedElement.style.fontSize = fontSize;
                selectedElement.style.borderRadius = borderRadius;
                selectedElement.style.padding = padding;
            }

            // שמירה במסד
            fetch('/design_settings', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    type: selectedType,
                    background: bg,
                    color: color,
                    font_family: fontFamily,
                    font_size: fontSize,
                    border_radius: borderRadius,
                    padding: padding,
                    text: (selectedType === 'title' || selectedType === 'subtitle') ? selectedElement.innerText : null
                })
            }).then(res => res.json()).then(data => {
                console.log("Saved:", data);
            });

            document.getElementById('editor-panel').classList.remove('active');
        }

        function rgbToHex(rgb) {
            let result = rgb.match(/\d+/g);
            return result ? "#" + result.slice(0, 3).map(x => {
                let hex = parseInt(x).toString(16);
                return hex.length === 1 ? "0" + hex : hex;
            }).join("") : rgb;
        }

        // מאזינים
        document.getElementById('page-title').addEventListener('click', function() {
            openEditor(this, 'title');
        });
        document.getElementById('page-subtitle').addEventListener('click', function() {
            openEditor(this, 'subtitle');
        });
        document.getElementById('day-button').addEventListener('click', function() {
            openEditor(this, 'day_button');
        });
        document.getElementById('slot-button').addEventListener('click', function() {
            openEditor(this, 'slot_button');
        });
    </script>
</body>
</html>
