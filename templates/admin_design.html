<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ניהול עיצוב</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      gap: 20px;
      margin: 0;
      padding: 0;
    }
    #preview {
      flex: 2;
      padding: 20px;
      min-height: 100vh;
    }
    #controls {
      flex: 1;
      background: #f7f7f7;
      padding: 20px;
      border-right: 2px solid #ccc;
      overflow-y: auto;
      max-height: 100vh;
    }
    h1, h2 {
      margin: 10px 0;
    }
    .day-button, .slot-button {
      margin: 5px;
      padding: 10px 15px;
      cursor: pointer;
      border: none;
    }
    label {
      display: block;
      margin-top: 10px;
      font-size: 14px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 5px;
      margin-top: 3px;
    }
    button.save {
      margin-top: 20px;
      width: 100%;
      padding: 10px;
      font-size: 16px;
      background: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
  </style>
  <script>
    let settings = {{ design_settings | tojson | safe }};
    function applySettings() {
      document.body.style.backgroundColor = settings.body_background_color;

      const heading = document.getElementById("heading");
      heading.textContent = settings.heading_text;
      heading.style.color = settings.heading_color;
      heading.style.fontSize = settings.heading_font_size + "px";
      heading.style.fontFamily = settings.heading_font_family;

      const subheading = document.getElementById("subheading");
      subheading.textContent = settings.subheading_text;
      subheading.style.color = settings.subheading_color;
      subheading.style.fontSize = settings.subheading_font_size + "px";
      subheading.style.fontFamily = settings.subheading_font_family;

      document.querySelectorAll(".day-button").forEach(btn => {
        btn.style.borderRadius = settings.day_button_shape;
        btn.style.backgroundColor = settings.day_button_color;
        btn.style.fontSize = settings.day_button_text_size + "px";
        btn.style.color = settings.day_button_text_color;
        btn.style.fontFamily = settings.day_button_font_family;
        btn.style.padding = settings.day_button_size + "px";
      });

      document.querySelectorAll(".slot-button").forEach(btn => {
        btn.style.borderRadius = settings.slot_button_shape;
        btn.style.backgroundColor = settings.slot_button_color;
        btn.style.fontSize = settings.slot_button_text_size + "px";
        btn.style.color = settings.slot_button_text_color;
        btn.style.fontFamily = settings.slot_button_font_family;
        btn.style.padding = settings.slot_button_size + "px";
      });
    }

    function updateField(field, value) {
      settings[field] = value;
      applySettings();
    }

    function saveSettings() {
      fetch("/business_settings", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(settings)
      })
      .then(r => r.json())
      .then(d => alert("ההגדרות נשמרו בהצלחה"))
      .catch(err => alert("שגיאה בשמירה"));
    }

    window.onload = () => {
      // למלא inputs עם הערכים
      for (const [key, value] of Object.entries(settings)) {
        const el = document.getElementById("ctrl_" + key);
        if (el) el.value = value;
      }
      applySettings();
    };
  </script>
</head>
<body>
  <div id="controls">
    <h3>הגדרות עיצוב</h3>

    <!-- כותרת -->
    <label>טקסט כותרת</label>
    <input id="ctrl_heading_text" oninput="updateField('heading_text', this.value)">
    <label>צבע כותרת</label>
    <input type="color" id="ctrl_heading_color" oninput="updateField('heading_color', this.value)">
    <label>גודל כותרת</label>
    <input type="number" id="ctrl_heading_font_size" oninput="updateField('heading_font_size', this.value)">
    <label>פונט כותרת</label>
    <input id="ctrl_heading_font_family" oninput="updateField('heading_font_family', this.value)">

    <!-- כותרת משנה -->
    <label>טקסט כותרת משנה</label>
    <input id="ctrl_subheading_text" oninput="updateField('subheading_text', this.value)">
    <label>צבע כותרת משנה</label>
    <input type="color" id="ctrl_subheading_color" oninput="updateField('subheading_color', this.value)">
    <label>גודל כותרת משנה</label>
    <input type="number" id="ctrl_subheading_font_size" oninput="updateField('subheading_font_size', this.value)">
    <label>פונט כותרת משנה</label>
    <input id="ctrl_subheading_font_family" oninput="updateField('subheading_font_family', this.value)">

    <!-- כפתורי ימים -->
    <h4>כפתורי ימים</h4>
    <label>צורה (border-radius)</label>
    <input id="ctrl_day_button_shape" oninput="updateField('day_button_shape', this.value)">
    <label>צבע רקע</label>
    <input type="color" id="ctrl_day_button_color" oninput="updateField('day_button_color', this.value)">
    <label>גודל ריווח</label>
    <input type="number" id="ctrl_day_button_size" oninput="updateField('day_button_size', this.value)">
    <label>גודל טקסט</label>
    <input type="number" id="ctrl_day_button_text_size" oninput="updateField('day_button_text_size', this.value)">
    <label>צבע טקסט</label>
    <input type="color" id="ctrl_day_button_text_color" oninput="updateField('day_button_text_color', this.value)">
    <label>פונט</label>
    <input id="ctrl_day_button_font_family" oninput="updateField('day_button_font_family', this.value)">

    <!-- כפתורי שעות -->
    <h4>כפתורי שעות</h4>
    <label>צורה (border-radius)</label>
    <input id="ctrl_slot_button_shape" oninput="updateField('slot_button_shape', this.value)">
    <label>צבע רקע</label>
    <input type="color" id="ctrl_slot_button_color" oninput="updateField('slot_button_color', this.value)">
    <label>גודל ריווח</label>
    <input type="number" id="ctrl_slot_button_size" oninput="updateField('slot_button_size', this.value)">
    <label>גודל טקסט</label>
    <input type="number" id="ctrl_slot_button_text_size" oninput="updateField('slot_button_text_size', this.value)">
    <label>צבע טקסט</label>
    <input type="color" id="ctrl_slot_button_text_color" oninput="updateField('slot_button_text_color', this.value)">
    <label>פונט</label>
    <input id="ctrl_slot_button_font_family" oninput="updateField('slot_button_font_family', this.value)">

    <!-- צבע רקע עמוד -->
    <h4>עמוד</h4>
    <label>צבע רקע</label>
    <input type="color" id="ctrl_body_background_color" oninput="updateField('body_background_color', this.value)">

    <button class="save" onclick="saveSettings()">שמור</button>
  </div>

  <div id="preview">
    <h1 id="heading"></h1>
    <h2 id="subheading"></h2>
    <div>
      <button class="day-button">ראשון</button>
      <button class="day-button">שני</button>
      <button class="day-button">שלישי</button>
    </div>
    <div>
      <button class="slot-button">08:00</button>
      <button class="slot-button">08:30</button>
      <button class="slot-button">09:00</button>
    </div>
  </div>
</body>
</html>
