<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<title>ניהול שירותים</title>
<style>
  body { font-family: Arial, sans-serif; background:#fafafa; padding:20px; }
  h2 { text-align:center; margin-bottom:20px; }
  .service-card {
    background:#fff;
    border:1px solid #ddd;
    border-radius:8px;
    padding:15px;
    margin-bottom:12px;
    box-shadow:0 1px 3px rgba(0,0,0,0.05);
    display:flex;
    flex-direction:column;
    gap:6px;
  }
  .service-card input[type="text"],
  .service-card input[type="number"] {
    padding:5px 8px;
    width:100%;
    border:1px solid #ccc;
    border-radius:4px;
  }
  .actions {
    display:flex;
    gap:8px;
    margin-top:6px;
  }
  button {
    padding:5px 12px;
    border:none;
    background:#3498db;
    color:#fff;
    border-radius:4px;
    cursor:pointer;
  }
  button.delete { background:#e74c3c; }
  button:hover { opacity:0.9; }
  #add-service { background:#2ecc71; margin-top:10px; width:100%; }
</style>
</head>
<body>

<h2>ניהול שירותים</h2>

<div id="services-container">
  {% for s in services %}
  <div class="service-card" data-id="{{ s.id }}">
    <label>שם:<input type="text" class="name" value="{{ s.name }}"></label>
    <label>משך (דקות):<input type="number" class="duration" value="{{ s.duration_minutes }}"></label>
    <label>מחיר (₪):<input type="number" class="price" value="{{ s.price }}"></label>
    <label><input type="checkbox" class="active" {% if s.active %}checked{% endif %}> פעיל</label>
    <div class="actions">
      <button class="save">שמור</button>
      <button class="delete">מחק</button>
    </div>
  </div>
  {% endfor %}
</div>

<button id="add-service">➕ הוסף שירות</button>

<script>
function saveService(card){
  const id = card.dataset.id;
  const payload = {
    name: card.querySelector('.name').value,
    duration_minutes: parseInt(card.querySelector('.duration').value) || 0,
    price: parseFloat(card.querySelector('.price').value) || 0,
    active: card.querySelector('.active').checked
  };
  const url = id==='0' ? '/services/add' : `/services/edit/${id}`;
  fetch(url,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(payload)
  }).then(r=>r.json()).then(d=>{
    if(d.id) card.dataset.id = d.id;
  });
}

function deleteService(card){
  const id = card.dataset.id;
  if(id==='0'){ card.remove(); return; }
  fetch(`/services/delete/${id}`,{method:'POST'})
    .then(r=>r.json()).then(d=>{ if(d.success) card.remove(); });
}

document.querySelectorAll('.save').forEach(btn=>{
  btn.onclick=()=>saveService(btn.closest('.service-card'));
});
document.querySelectorAll('.delete').forEach(btn=>{
  btn.onclick=()=>deleteService(btn.closest('.service-card'));
});

document.getElementById('add-service').onclick = ()=>{
  const cont=document.getElementById('services-container');
  const card=document.createElement('div');
  card.className='service-card';
  card.dataset.id='0';
  card.innerHTML=`
    <label>שם:<input type="text" class="name" value="שירות חדש"></label>
    <label>משך (דקות):<input type="number" class="duration" value="30"></label>
    <label>מחיר (₪):<input type="number" class="price" value="0"></label>
    <label><input type="checkbox" class="active" checked> פעיל</label>
    <div class="actions">
      <button class="save">שמור</button>
      <button class="delete">מחק</button>
    </div>`;
  cont.appendChild(card);
  card.querySelector('.save').onclick=()=>saveService(card);
  card.querySelector('.delete').onclick=()=>deleteService(card);
};
</script>

</body>
</html>
