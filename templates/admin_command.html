<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>× ×™×”×•×œ HairBoss</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 900px; margin: 20px auto; padding: 20px; background: #eef2f7; color: #222; direction: rtl; }
  h1, h2 { text-align: center; }
  table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
  th, td { border: 1px solid #aaa; padding: 8px; text-align: center; }
  th { background: #3498db; color: white; }
  input[type="time"], input[type="text"] { width: 80px; padding: 5px; }
  button { padding: 5px 10px; margin: 0 2px; border: none; border-radius: 4px; cursor: pointer; }
  .add-btn { background: #2ecc71; color: white; }
  .remove-btn { background: #e74c3c; color: white; }
  .edit-btn { background: #f39c12; color: white; }
  .section { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 0 8px #ccc; margin-bottom: 30px; }
  a { text-decoration: none; color: #2980b9; }
  .logout { float: left; font-weight: bold; color: red; }
  .top-nav { overflow: hidden; margin-bottom: 20px; }
</style>
<script>
async function updateWeeklySchedule(action, day_key, time, new_time=null) {
  const body = { action, day_key, time };
  if (new_time) body.new_time = new_time;

  const res = await fetch('/weekly_schedule', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(body)
  });
  const data = await res.json();
  if (data.error) alert('Error: ' + data.error);
  else location.reload();
}

async function updateOverrides(action, date, time=null) {
  const body = { action, date };
  if(time) body.time = time;

  const res = await fetch('/overrides', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(body)
  });
  const data = await res.json();
  if (data.error) alert('Error: ' + data.error);
  else location.reload();
}
</script>
</head>
<body>

<div class="top-nav">
  <a href="/" target="_blank">ğŸ  ×¦×¤×™×™×” ×‘×¢××•×“ ×”×”×–×× ×•×ª</a>
  <a href="/bot_knowledge">âœï¸ ×¢×¨×™×›×ª ×™×“×¢ ×”×‘×•×˜</a>
  <a href="/appointments">ğŸ“‹ ×¦×¤×™×™×” ×‘×ª×•×¨×™×</a>
  <a href="/logout" class="logout">ğŸ”“ ×”×ª× ×ª×§</a>
</div>

<h1>× ×™×”×•×œ HairBoss</h1>

<div class="section">
  <h2>×©×’×¨×” ×©×‘×•×¢×™×ª (×–×× ×™ ×¢×‘×•×“×” ×§×‘×•×¢×™×)</h2>
  <table>
    <thead>
      <tr>
        <th>×™×•× ×‘×©×‘×•×¢</th>
        <th>×©×¢×•×ª ×–××™× ×•×ª</th>
        <th>×”×•×¡×¤×”</th>
      </tr>
    </thead>
    <tbody>
      {% for day_key in ['0','1','2','3','4','5','6'] %}
        <tr>
          <td>
            {% set day_names = ["×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™","×©×‘×ª","×¨××©×•×Ÿ"] %}
            {{ day_names[day_key|int] }}
          </td>
          <td>
            {% for time in weekly_schedule.get(day_key, []) %}
              {{ time }}
              <button class="remove-btn" onclick="updateWeeklySchedule('remove','{{day_key}}','{{time}}')">âœ–ï¸</button>
              <br/>
            {% else %}
              <em>××™×Ÿ ×–××™× ×•×ª</em>
            {% endfor %}
          </td>
          <td>
            <input type="time" id="add-time-{{day_key}}" />
            <button class="add-btn" onclick="
              const t = document.getElementById('add-time-{{day_key}}').value;
              if(t) updateWeeklySchedule('add','{{day_key}}',t);
              else alert('× × ×œ×‘×—×•×¨ ×©×¢×” ×œ×”×•×¡×¤×”');
            ">×”×•×¡×£</button>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="section">
  <h2>×©×™× ×•×™×™× ×—×“-×¤×¢××™×™× (×”×•×¡×¤×”/×”×¡×¨×” ×©×œ ×©×¢×•×ª ×œ×™×•× ××¡×•×™×)</h2>
  <table>
    <thead>
      <tr>
        <th>×ª××¨×™×š</th>
        <th>×”×•×¡×¤×”</th>
        <th>×”×¡×¨×”</th>
        <th>× ×™×§×•×™ ×›×œ ×”×©×™× ×•×™×™×</th>
      </tr>
    </thead>
    <tbody>
      {% for date, override in overrides.items() %}
        <tr>
          <td>{{ date }}</td>
          <td>
            {% for t in override.add %}
              {{ t }} <button class="remove-btn" onclick="updateOverrides('remove','{{date}}','{{t}}')">×”×¡×¨</button><br/>
            {% else %}
              <em>××™×Ÿ</em>
            {% endfor %}
            <input type="time" id="add-{{date}}" />
            <button class="add-btn" onclick="
              const t = document.getElementById('add-{{date}}').value;
              if(t) updateOverrides('add','{{date}}',t);
              else alert('× × ×œ×‘×—×•×¨ ×©×¢×” ×œ×”×•×¡×¤×”');
            ">×”×•×¡×£</button>
          </td>
          <td>
            {% for t in override.remove %}
              {{ t }} <button class="remove-btn" onclick="updateOverrides('add','{{date}}','{{t}}')">×‘×˜×œ ×”×¡×¨×”</button><br/>
            {% else %}
              <em>××™×Ÿ</em>
            {% endfor %}
          </td>
          <td>
            <button class="remove-btn" onclick="if(confirm('×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ× ×§×•×ª ××ª ×›×œ ×”×©×™× ×•×™×™× ×‘×ª××¨×™×š ×–×”?')) updateOverrides('clear','{{date}}')">× ×§×”</button>
          </td>
        </tr>
      {% else %}
        <tr><td colspan="4"><em>××™×Ÿ ×©×™× ×•×™×™× ×—×“-×¤×¢××™×™×</em></td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="section">
  <h2>×ª×•×¨×™× ×©×”×•×–×× ×•</h2>
  <table>
    <thead>
      <tr>
        <th>×ª××¨×™×š</th>
        <th>×©×¢×”</th>
        <th>×©×</th>
        <th>×˜×œ×¤×•×Ÿ</th>
        <th>×©×™×¨×•×ª</th>
        <th>××—×™×¨</th>
      </tr>
    </thead>
    <tbody>
      {% for date, appts in appointments.items() %}
        {% for appt in appts %}
          <tr>
            <td>{{ date }}</td>
            <td>{{ appt.time }}</td>
            <td>{{ appt.name }}</td>
            <td>{{ appt.phone }}</td>
            <td>{{ appt.service }}</td>
            <td>{{ appt.price }} â‚ª</td>
          </tr>
        {% endfor %}
      {% else %}
        <tr><td colspan="6"><em>××™×Ÿ ×ª×•×¨×™×</em></td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div style="text-align:center; margin-top:30px;">
  <a href="/">×—×–×¨×” ×œ×“×£ ×”×‘×™×ª</a>
</div>

</body>
</html>

